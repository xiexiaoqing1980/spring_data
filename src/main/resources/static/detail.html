<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<script type="text/javascript" src="/js/jquery-1.12.4.min.js"></script>
<!--<script type="text/javascript" src="/js/bootstrap.min.js"></script>-->
<body>
<div class="index-container">
    <div class="topic-flow-container">
        <div class="group-list-container">
            <div class="group-list-wrapper"></div>
        </div>

        <div class="main-content-container">
            <!--<div class="post-container"></div>-->
            <div class="topic-filter-container">
                <div class="filter-container">过滤器</div>
                <!--<div class="select-icon"></div>-->
            </div>

            <div class="sticky-topic-container">置顶帖</div>

            <div class="topics-container">
            </div>

            <div class="next-page">
                下一页
            </div>

        </div>

        <div class="group-preview-container">
            <div class="group-preview-wrapper">
            </div>
        </div>

        <div class="go-top" id="js-gotop">返回顶部</div>
    </div>
</div>



</body>
<script>
    var page=0;
    $(document).ready(function() {
        getDetail( page);

    })
    function convertTime(timestamp) {
        var date = new Date(timestamp); //时间戳为10位需*1000，时间戳为13位的话不需乘1000
        Y = date.getFullYear() + '-';
        M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
        D = change(date.getDate()) + ' ';
        h = change(date.getHours()) + ':';
        m = change(date.getMinutes()) + ':';
        s = change(date.getSeconds());
        return Y + M + D + h + m + s;
    }
    function change(t) {
        if (t < 10) {
            return "0" + t;
        } else {
            return t;
        }
//
    }

    function  getQueryVariable(variable){
	var str =location.search.length >0 ? location.search.substring(1):"";
	var vars =str.split("&");
	for(var i=0;i<vars.length; i++){
		 var item=vars[i].split("=");
		if(item[0]== variable){
			return item[1];
	 }
     }
    }
    
    function getDetail( page) {
        var id=getQueryVariable("id");
        $.ajax({
// <!--            url: "http://127.0.0.1:8081/zsxq/yecheng",-->
            url: "http://127.0.0.1:8081/zsxq/yecheng"+"?id="+id+"&page="+page,
// <!--            url: "http://120.24.90.17:8088/zsxq/query/origin/detail?id=824511824552",-->
            dataType: "json",//数据格式
            type: "get",//请求方式
            async: true,//是否异步请求
            // error: erryFunction, //错误执行方法
            success: function (data) {   //如果请求成功，返回数据。
                var html = "";
                var model = data.model;   //获取model数组
                $.each(model, function (index1, item) {
                    var comment='';
                    var show_comments=item.show_comments;
                    if ((show_comments)!==null && show_comments.length!==0 ) {      //不为空时才进行评论拼接
                        $.each(show_comments,function (index,value) {
                            comment+= '<div class="comment-item-container"><div class="comment-item"><span class="comment-owner">' +
                                value.owner.name + '</span><span>' + value.text + '</span>'
                                + '</div><div class="comment-time">' + convertTime(value.create_time) + '</div></div>';

                        })
                    }
                    //正文中图片的拼接
                    var image=item.talk.images;
                    var image_html='';
                    if (image!==null){
                        if(image.length>1){   //有多张图片
                            image_html='<div class="image-gallery-container">'+'<div class="image-more"><div class="image-container"><img class="image-item" src=""></div>'

                        }   //只有一张图片
                    }

                   '


                    html += '<div class="topic-container"><div class="topic-header-container">' +
                        '<div class="author"><div class="info"><div class="role-owner">' + item.talk.owner.name + ' </div>' +
                        '<div class="date">' + convertTime(item.create_time) + '</div></div></div></div>' + '<div class="talk-content-container"><div class="content">' + item.talk.text + '</div></div> <div class="comment-box">'+comment+'</div></div>'


                    // $('.topics-container').append(html)
                });
                $('.topics-container').html(html);

            }
        })
        
    }
    $(".next-page").click(function () {
        page+=1;
        getDetail(page);
    } )

    $(".go-top").click(function () {
        page=0;
        getDetail(page);
    } )

    $(function () {
                /*自定义字符串格式化*/
           String.prototype.Format = function (args) {
                     /*this代表要调用Format方法的字符串*/
                     /*replace的第一个参数为正则表达式，g表示处理匹配到的所有字符串，在js中使用//包起来*/
                     /*replace的第二个参数为匹配字符串的处理，k1匹配结果包含{}，k2只保留{}内的内容*/
                     var temp = this.replace(/\{(\w+)\}/g, function (k1, k2) {
                             console.log(k1, k2);
                             /*replace将匹配到的k2用参数args替换后赋给新变量temp*/
                             return args[k2];
                         });
                     /*自定义方法Format将格式化后的字符串返回*/
                     return temp;
                 };
         })


// <!-- alert(1)-->
</script>
</html>